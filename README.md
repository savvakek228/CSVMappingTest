Сделал в двух вариантах - синхронное составление отчетов, и асинхронное. 

Каждый вариант в соответствующей ветке (sync_variant и async_variant) - код в мастере лучше не проверять
